{"ast":null,"code":"export var REGISTRY_FINALIZE_AFTER = 10000;\nexport var REGISTRY_SWEEP_INTERVAL = 10000;\n\nvar TimerBasedFinalizationRegistry =\n/** @class */\nfunction () {\n  function TimerBasedFinalizationRegistry(finalize) {\n    var _this = this;\n\n    Object.defineProperty(this, \"finalize\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: finalize\n    });\n    Object.defineProperty(this, \"registrations\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: new Map()\n    });\n    Object.defineProperty(this, \"sweepTimeout\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    }); // Bound so it can be used directly as setTimeout callback.\n\n    Object.defineProperty(this, \"sweep\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: function (maxAge) {\n        if (maxAge === void 0) {\n          maxAge = REGISTRY_FINALIZE_AFTER;\n        } // cancel timeout so we can force sweep anytime\n\n\n        clearTimeout(_this.sweepTimeout);\n        _this.sweepTimeout = undefined;\n        var now = Date.now();\n\n        _this.registrations.forEach(function (registration, token) {\n          if (now - registration.registeredAt >= maxAge) {\n            _this.finalize(registration.value);\n\n            _this.registrations.delete(token);\n          }\n        });\n\n        if (_this.registrations.size > 0) {\n          _this.scheduleSweep();\n        }\n      }\n    }); // Bound so it can be exported directly as clearTimers test utility.\n\n    Object.defineProperty(this, \"finalizeAllImmediately\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: function () {\n        _this.sweep(0);\n      }\n    });\n  } // Token is actually required with this impl\n\n\n  Object.defineProperty(TimerBasedFinalizationRegistry.prototype, \"register\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (target, value, token) {\n      this.registrations.set(token, {\n        value: value,\n        registeredAt: Date.now()\n      });\n      this.scheduleSweep();\n    }\n  });\n  Object.defineProperty(TimerBasedFinalizationRegistry.prototype, \"unregister\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (token) {\n      this.registrations.delete(token);\n    }\n  });\n  Object.defineProperty(TimerBasedFinalizationRegistry.prototype, \"scheduleSweep\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      if (this.sweepTimeout === undefined) {\n        this.sweepTimeout = setTimeout(this.sweep, REGISTRY_SWEEP_INTERVAL);\n      }\n    }\n  });\n  return TimerBasedFinalizationRegistry;\n}();\n\nexport { TimerBasedFinalizationRegistry };\nexport var UniversalFinalizationRegistry = typeof FinalizationRegistry !== \"undefined\" ? FinalizationRegistry : TimerBasedFinalizationRegistry;","map":{"version":3,"sources":["../../src/utils/UniversalFinalizationRegistry.ts"],"names":[],"mappings":"AAQA,OAAO,IAAM,uBAAuB,GAAG,KAAhC;AACP,OAAO,IAAM,uBAAuB,GAAG,KAAhC;;AAEP,IAAA,8BAAA;AAAA;AAAA,YAAA;AAII,WAAA,8BAAA,CAA6B,QAA7B,EAAyD;AAAzD,QAAA,KAAA,GAAA,IAAA;;;;;;aAA6B;;AAH7B,IAAA,MAAA,CAAA,cAAA,CAAA,IAAA,EAAA,eAAA,EAAA;sBAAA;wBAAA;oBAAA;aAA0E,IAAI,GAAJ;AAA1E,KAAA;AACA,IAAA,MAAA,CAAA,cAAA,CAAA,IAAA,EAAA,cAAA,EAAA;sBAAA;wBAAA;oBAAA;;AAAA,KAAA,EAEyD,CAezD;;AACA,IAAA,MAAA,CAAA,cAAA,CAAA,IAAA,EAAA,OAAA,EAAA;sBAAA;wBAAA;oBAAA;aAAQ,UAAC,MAAD,EAAiC;AAAhC,YAAA,MAAA,KAAA,KAAA,CAAA,EAAA;AAAA,UAAA,MAAA,GAAA,uBAAA;AAAgC,SAAA,CACrC;;;AACA,QAAA,YAAY,CAAC,KAAI,CAAC,YAAN,CAAZ;AACA,QAAA,KAAI,CAAC,YAAL,GAAoB,SAApB;AAEA,YAAM,GAAG,GAAG,IAAI,CAAC,GAAL,EAAZ;;AACA,QAAA,KAAI,CAAC,aAAL,CAAmB,OAAnB,CAA2B,UAAC,YAAD,EAAe,KAAf,EAAoB;AAC3C,cAAI,GAAG,GAAG,YAAY,CAAC,YAAnB,IAAmC,MAAvC,EAA+C;AAC3C,YAAA,KAAI,CAAC,QAAL,CAAc,YAAY,CAAC,KAA3B;;AACA,YAAA,KAAI,CAAC,aAAL,CAAmB,MAAnB,CAA0B,KAA1B;AACH;AACJ,SALD;;AAOA,YAAI,KAAI,CAAC,aAAL,CAAmB,IAAnB,GAA0B,CAA9B,EAAiC;AAC7B,UAAA,KAAI,CAAC,aAAL;AACH;AACJ;AAhBD,KAAA,EAhByD,CAkCzD;;AACA,IAAA,MAAA,CAAA,cAAA,CAAA,IAAA,EAAA,wBAAA,EAAA;sBAAA;wBAAA;oBAAA;aAAyB,YAAA;AACrB,QAAA,KAAI,CAAC,KAAL,CAAW,CAAX;AACH;AAFD,KAAA;AAnC6D,GAJjE,CAMI;;;;;;;WACA,UAAS,MAAT,EAAyB,KAAzB,EAAmC,KAAnC,EAAiD;AAC7C,WAAK,aAAL,CAAmB,GAAnB,CAAuB,KAAvB,EAA8B;AAC1B,QAAA,KAAK,EAAA,KADqB;AAE1B,QAAA,YAAY,EAAE,IAAI,CAAC,GAAL;AAFY,OAA9B;AAIA,WAAK,aAAL;AACH;;;;;;WAED,UAAW,KAAX,EAAyB;AACrB,WAAK,aAAL,CAAmB,MAAnB,CAA0B,KAA1B;AACH;;;;;;WA0BD,YAAA;AACI,UAAI,KAAK,YAAL,KAAsB,SAA1B,EAAqC;AACjC,aAAK,YAAL,GAAoB,UAAU,CAAC,KAAK,KAAN,EAAa,uBAAb,CAA9B;AACH;AACJ;;AACL,SAAA,8BAAA;AAAC,CAhDD,EAAA;;;AAkDA,OAAO,IAAM,6BAA6B,GACtC,OAAO,oBAAP,KAAgC,WAAhC,GACM,oBADN,GAEM,8BAHH","sourceRoot":"","sourcesContent":["export var REGISTRY_FINALIZE_AFTER = 10000;\nexport var REGISTRY_SWEEP_INTERVAL = 10000;\nvar TimerBasedFinalizationRegistry = /** @class */ (function () {\n    function TimerBasedFinalizationRegistry(finalize) {\n        var _this = this;\n        Object.defineProperty(this, \"finalize\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: finalize\n        });\n        Object.defineProperty(this, \"registrations\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: new Map()\n        });\n        Object.defineProperty(this, \"sweepTimeout\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        // Bound so it can be used directly as setTimeout callback.\n        Object.defineProperty(this, \"sweep\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: function (maxAge) {\n                if (maxAge === void 0) { maxAge = REGISTRY_FINALIZE_AFTER; }\n                // cancel timeout so we can force sweep anytime\n                clearTimeout(_this.sweepTimeout);\n                _this.sweepTimeout = undefined;\n                var now = Date.now();\n                _this.registrations.forEach(function (registration, token) {\n                    if (now - registration.registeredAt >= maxAge) {\n                        _this.finalize(registration.value);\n                        _this.registrations.delete(token);\n                    }\n                });\n                if (_this.registrations.size > 0) {\n                    _this.scheduleSweep();\n                }\n            }\n        });\n        // Bound so it can be exported directly as clearTimers test utility.\n        Object.defineProperty(this, \"finalizeAllImmediately\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: function () {\n                _this.sweep(0);\n            }\n        });\n    }\n    // Token is actually required with this impl\n    Object.defineProperty(TimerBasedFinalizationRegistry.prototype, \"register\", {\n        enumerable: false,\n        configurable: true,\n        writable: true,\n        value: function (target, value, token) {\n            this.registrations.set(token, {\n                value: value,\n                registeredAt: Date.now()\n            });\n            this.scheduleSweep();\n        }\n    });\n    Object.defineProperty(TimerBasedFinalizationRegistry.prototype, \"unregister\", {\n        enumerable: false,\n        configurable: true,\n        writable: true,\n        value: function (token) {\n            this.registrations.delete(token);\n        }\n    });\n    Object.defineProperty(TimerBasedFinalizationRegistry.prototype, \"scheduleSweep\", {\n        enumerable: false,\n        configurable: true,\n        writable: true,\n        value: function () {\n            if (this.sweepTimeout === undefined) {\n                this.sweepTimeout = setTimeout(this.sweep, REGISTRY_SWEEP_INTERVAL);\n            }\n        }\n    });\n    return TimerBasedFinalizationRegistry;\n}());\nexport { TimerBasedFinalizationRegistry };\nexport var UniversalFinalizationRegistry = typeof FinalizationRegistry !== \"undefined\"\n    ? FinalizationRegistry\n    : TimerBasedFinalizationRegistry;\n//# sourceMappingURL=UniversalFinalizationRegistry.js.map"]},"metadata":{},"sourceType":"module"}